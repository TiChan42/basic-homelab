# check-mount.yml
- name: Set up cron job to check NFS mount availability
  hosts: localhost
  connection: local
  become: true

  vars_files: []

  tasks:
    - name: Create check script
      ansible.builtin.template:
        src: templates/check_nfs_mount.sh.j2
        dest: "{{ check_mount_nfs_script_path }}"
        mode: "0755"
        owner: root
        group: root

    - name: Set up cron job for mount check (runs cyclically)
      ansible.builtin.cron:
        name: "Check NFS mount availability cyclic"
        minute: "{{ check_mount_nfs_cron_minute }}"
        job: "{{ check_mount_nfs_script_path }}"
        user: root
        state: present

    - name: Set up cron job for mount check (runs at reboot)
      ansible.builtin.cron:
        name: "Check NFS mount availability reboot"
        special_time: reboot
        job: "{{ check_mount_nfs_script_path }}"
        user: root
        state: present