# File: initial-setup/ansible/site.yml
- name: System Configuration (Repositories, IOMMU, SSH)
  import_playbook: system_setup.yml

# Dynamic Service Execution
# We iterate over the 'services' list from config.yml.
# If a service is enabled, we include its playbook.

- hosts: localhost
  gather_facts: false
  tasks:
    - name: Run Service Playbooks
      include_tasks: "{{ item.playbook }}"
      loop: "{{ services }}"
      when: item.enabled | default(false) | bool
      loop_control:
        loop_var: service_config
